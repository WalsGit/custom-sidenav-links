module.exports=function(t){var n={};function a(i){if(n[i])return n[i].exports;var e=n[i]={i:i,l:!1,exports:{}};return t[i].call(e.exports,e,e.exports,a),e.l=!0,e.exports}return a.m=t,a.c=n,a.d=function(t,n,i){a.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,n){if(1&n&&(t=a(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var e in t)a.d(i,e,function(n){return t[n]}.bind(null,e));return i},a.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(n,"a",n),n},a.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},a.p="",a(a.s=15)}([function(t,n){t.exports=flarum.core.compat.app},function(t,n){t.exports=flarum.core.compat["common/components/Button"]},function(t,n,a){"use strict";a.d(n,"a",(function(){return i}));var i=function(){function t(t,n,a,i){this.icon=t,this.text=n,this.url=a,this.internal=i||!1}t.fromJsObject=function(n){return new t(n.icon,n.text,n.url,n.internal)};var n=t.prototype;return n.toString=function(){return JSON.stringify({icon:this.icon,text:this.text,url:this.url,internal:this.internal})},n.toJSON=function(){return{icon:this.icon,text:this.text,url:this.url,internal:this.internal}},t}()},function(t,n){t.exports=flarum.core.compat["common/utils/extractText"]},function(t,n){t.exports=flarum.core.compat["common/components/Switch"]},function(t,n){t.exports=flarum.core.compat["common/Component"]},,,,,function(t,n){t.exports=flarum.core.compat["components/ExtensionPage"]},function(t,n){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,n){t.exports=flarum.core.compat["common/components/Select"]},function(t,n){t.exports=flarum.core.compat["common/utils/saveSettings"]},function(t,n){t.exports=flarum.core.compat["common/components/Modal"]},function(t,n,a){"use strict";function i(t,n){return(i=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function e(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,i(t,n)}a.r(n);var o=a(0),l=a.n(o),s=a(10),r=a.n(s),d=a(1),c=a.n(d),u=a(4),h=a.n(u),p=a(11),v=a.n(p),f=a(5),b=a.n(f),k=a(3),g=a.n(k),w=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var a=n.prototype;return a.view=function(){return m("input",{type:"text","aria-labelled-by":this.attrs.labelId,className:"FormControl "+this.attrs.class,placeholder:g()(this.attrs.placeholder),disabled:!!this.attrs.disabled,value:this.attrs.value,onchange:this.onChange.bind(this)})},a.onChange=function(t){if("function"==typeof this.attrs.onChange){var n=t.target;this.attrs.onChange(n.value,n)}},n}(b.a),y=a(12),_=a.n(y),x=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var a=n.prototype;return a.view=function(){return m(_.a,{type:"text",className:"FormControl "+this.attrs.class,disabled:!!this.attrs.disabled,value:this.attrs.value,onchange:this.onChange.bind(this),options:this.attrs.options})},a.onChange=function(t){"function"==typeof this.attrs.onChange&&this.attrs.onChange(t)},n}(b.a),D=a(13),S=a.n(D),B=a(2);function L(t){var n;try{n=new URL(t)}catch(t){return!1}return("http:"===n.protocol||"https:"===n.protocol)&&n.hostname.includes(".")}var O=a(14),C=function(t,n){return app.translator.trans("davwheat.custom_sidenav_links.admin.settings_page.new_link_modal."+t,n)},N=function(t){function n(){for(var n,a=arguments.length,i=new Array(a),e=0;e<a;e++)i[e]=arguments[e];return(n=t.call.apply(t,[this].concat(i))||this).loading=!1,n.newLink=new B.a("","","",!1),n}e(n,t);var a=n.prototype;return a.className=function(){return"davwheat-sidenav-AddLinkModal Modal--small"},a.title=function(){return g()(C("title"))},a.content=function(){var t=this,n=L(this.newLink.url);return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("div",null,m("label",null,C("labels.icon"),m("div",{class:"icon-preview-container"},m("span",{class:"icon-preview fa-fw "+this.newLink.icon,title:C("table.icon_preview_tooltip")}),m(w,{value:this.newLink.icon,onChange:function(n){t.newLink.icon=n},placeholder:C("placeholders.icon"),disabled:!1})))),m("div",null,m("label",null,C("labels.text"),m(w,{value:this.newLink.text,onChange:function(n){t.newLink.text=n},placeholder:C("placeholders.text"),disabled:!1}))),m("div",null,m("label",null,C("labels.url"),m(w,{class:!n&&"sidenav-input--invalid",value:this.newLink.url,onChange:function(n){t.newLink.url=n},placeholder:C("placeholders.url"),disabled:!1}))),m("div",null,m(h.a,{state:this.newLink.internal,onchange:function(n){t.newLink.internal=n},disabled:!1},C("labels.internal"))),m(c.a,{className:"Button Button--primary",type:"submit",disabled:!n||this.loading||!this.isValid(),loading:this.loading},this.getButtonText(n)))))},a.getButtonText=function(t){return t?this.loading?C("submit_btn.loading"):this.isValid()?C("submit_btn.add"):C("submit_btn.invalid_form"):C("submit_btn.fix_url")},a.isValid=function(){return""!==this.newLink.icon.trim()&&""!==this.newLink.text.trim()&&""!==this.newLink.url.trim()},a.onsubmit=function(){this.loading=!0,this.hide.bind(this)(),this.attrs.links.push(this.newLink)},n}(a.n(O).a),j="davwheat-custom-sidenav-links.link-data",P=function(t,n){return l.a.translator.trans("davwheat.custom_sidenav_links.admin.settings_page."+t,n)},I=function(t){function n(){for(var n,a=arguments.length,i=new Array(a),e=0;e<a;e++)i[e]=arguments[e];return(n=t.call.apply(t,[this].concat(i))||this).loading=!1,n.isDirty=!1,n.isAnyUrlInvalid=!1,n.rawLinkData=l.a.data.settings["davwheat-custom-sidenav-links.link-data"],n.linkData=null,n.linkPosition=l.a.data.settings["davwheat-custom-sidenav-links.position"]||"above-tags-link",n.showTopSpacer=l.a.data.settings["davwheat-custom-sidenav-links.top-spacer"]||!0,n.showBottomSpacer=l.a.data.settings["davwheat-custom-sidenav-links.bottom-spacer"]||!0,n}e(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.createData()},a.content=function(){var t=this;if(!this.rawLinkData)return m("p",null,"My settings key (",m("code",null,j),") is missing from your database! Make sure you've run the migrations. If that doesn't work, add it to your settings table manually with the content ",m("code",null,"[]"),".");if(!this.linkData)return m("div",{class:"davwheat-ext-settings"},m("form",null,m(v.a,null)));var n=!1;return m("div",{class:"davwheat-ext-settings"},m("form",null,m("section",{className:"davwheat-sidenav-addlink davwheat-custom-sidenav-links--display-options"},m("h2",null,P("display_options.heading")),m("label",null,P("display_options.labels.position"),m(x,{value:this.linkPosition,options:{"above-tags-link":P("display_options.options.position.above-tags-link"),"below-tags-link":P("display_options.options.position.below-tags-link")},disabled:this.loading,onChange:function(n){t.linkPosition=n,t.makeDirty()}})),m("label",null,P("display_options.labels.top_spacer"),m(h.a,{state:this.showTopSpacer,disabled:this.loading,onchange:function(n){t.showTopSpacer=n,t.makeDirty()}})),m("label",null,P("display_options.labels.bottom_spacer"),m(h.a,{state:this.showBottomSpacer,disabled:this.loading,onchange:function(n){t.showBottomSpacer=n,t.makeDirty()}})))),m("form",null,m("section",{class:"davwheat-sidenav-addlink"},m("h2",null,P("link_table.heading")),m(c.a,{class:"Button davwheat-sidenav-addlink-btn",icon:"fas fa-plus",onclick:function(){l.a.modal.show(N,{links:t.linkData}),t.makeDirty()},disabled:this.loading},P("link_table.add_link_btn"))),m("div",{class:"scroll-container"},m("main",null,m("div",{id:"davwheat-sidenav--position-heading"},P("link_table.table.header.position")),m("div",{id:"davwheat-sidenav--icon-heading"},P("link_table.table.header.icon")),m("div",{id:"davwheat-sidenav--text-heading"},P("link_table.table.header.text")),m("div",{id:"davwheat-sidenav--url-heading"},P("link_table.table.header.url")),m("div",{id:"davwheat-sidenav--internal-heading"},P("link_table.table.header.internal")),m("div",{id:"davwheat-sidenav--delete-heading"},P("link_table.table.header.delete")),this.linkData.map((function(a,i){var e,o=L(a.url);return o||(n=!0),[m("div",{"data-column":"position"},m(c.a,{class:"Button Button--icon",icon:"fas fa-arrow-up",title:P("link_table.table.tooltips.move_up"),disabled:0===i||t.loading,onclick:function(){0!==i&&t.linkData&&(t.linkData[i]=t.linkData[i-1],t.linkData[i-1]=a)}}),m(c.a,{class:"Button Button--icon",icon:"fas fa-arrow-down",title:P("link_table.table.tooltips.move_down"),disabled:i===((null==(e=t.linkData)?void 0:e.length)||1)-1||t.loading,onclick:function(){var n;i!==((null==(n=t.linkData)?void 0:n.length)||1)-1&&t.linkData&&(t.linkData[i]=t.linkData[i+1],t.linkData[i+1]=a)}})),m("div",{"data-column":"icon"},m("span",{class:"icon-preview fa-fw "+a.icon,title:P("link_table.table.tooltips.icon_preview")}),m(w,{value:a.icon,onChange:function(n){t.linkData&&(t.linkData[i].icon=n,t.makeDirty())},labelId:"davwheat-sidenav--icon-heading",placeholder:P("link_table.table.placeholders.icon"),disabled:t.loading})),m("div",{"data-column":"text"},m(w,{value:a.text,onChange:function(n){t.linkData&&(t.linkData[i].text=n,t.makeDirty())},labelId:"davwheat-sidenav--text-heading",placeholder:P("link_table.table.placeholders.text"),disabled:t.loading})),m("div",{"data-column":"url"},m(w,{class:!o&&"sidenav-input--invalid",value:a.url,onChange:function(n){t.linkData&&(t.linkData[i].url=n,t.makeDirty())},labelId:"davwheat-sidenav--url-heading",placeholder:P("link_table.table.placeholders.url"),disabled:t.loading})),m("div",{"data-column":"internal"},m(h.a,{state:a.internal,onchange:function(n){t.linkData&&(t.linkData[i].internal=n,t.makeDirty())},"aria-labelled-by":"davwheat-sidenav--url-heading",disabled:t.loading})),m("div",{"data-column":"delete"},m(c.a,{class:"Button Button--icon",icon:"fas fa-trash","aria-labelled-by":"davwheat-sidenav--delete-heading",onclick:function(){var n;confirm(g()(P("link_table.confirm_delete",{link:a.text})))&&(null==(n=t.linkData)||n.splice(i,1))},disabled:t.loading}))]})))),m(c.a,{onclick:this.saveSettings.bind(this),className:"Button Button--primary",loading:this.loading,disabled:n||!this.isDirty||this.loading},this.getButtonText(n))))},a.getButtonText=function(t){return this.isAnyUrlInvalid=t,this.isAnyUrlInvalid?P("link_table.save_btn.fix_errors"):this.loading?P("link_table.save_btn.saving"):this.isDirty?P("link_table.save_btn.dirty"):P("link_table.save_btn.saved")},a.createData=function(){var t,n=this.rawLinkData;try{t=Object.freeze(JSON.parse(n))}catch(t){throw"Invalid JSON found in Flarum setting `"+j+"`. We can't continue. Fix manually, or reset to `[]` in your DB."}var a=[];t.forEach((function(t){return a.push(B.a.fromJsObject(t))})),this.linkData=a},a.makeDirty=function(){this.isDirty=!0},a.saveSettings=function(t){var n;if(t.preventDefault(),!this.isAnyUrlInvalid){l.a.alerts.clear(),this.loading=!0;JSON.stringify(this.linkData);return S()((n={},n[j]=JSON.stringify(this.linkData),n["davwheat-custom-sidenav-links.position"]=this.linkPosition,n["davwheat-custom-sidenav-links.top-spacer"]=this.showTopSpacer,n["davwheat-custom-sidenav-links.bottom-spacer"]=this.showBottomSpacer,n)).then(this.onSettingsSaved.bind(this))}l.a.alerts.show({type:"error"},P("link_table.alert.fix_errors"))},a.onSettingsSaved=function(){this.loading=!1,this.isDirty=!1,l.a.alerts.show({type:"success"},l.a.translator.trans("core.admin.settings.saved_message"))},n}(r.a);app.initializers.add("davwheat/custom-sidenav-links",(function(t){t.extensionData.for("davwheat-custom-sidenav-links").registerPage(I)}))}]);
//# sourceMappingURL=admin.js.map