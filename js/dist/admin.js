module.exports=function(t){var n={};function e(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var a in t)e.d(i,a,function(n){return t[n]}.bind(null,a));return i},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=14)}([function(t,n){t.exports=flarum.core.compat["common/components/Button"]},function(t,n){t.exports=flarum.core.compat.app},function(t,n,e){"use strict";e.d(n,"a",(function(){return i}));var i=function(){function t(t,n,e,i){this.icon=t,this.text=n,this.url=e,this.internal=i}t.fromJsObject=function(n){return new t(n.icon,n.text,n.url,n.internal)};var n=t.prototype;return n.toString=function(){return JSON.stringify({icon:this.icon,text:this.text,url:this.url,internal:this.internal})},n.toJSON=function(){return{icon:this.icon,text:this.text,url:this.url,internal:this.internal}},t}()},function(t,n){t.exports=flarum.core.compat["common/components/Switch"]},function(t,n){t.exports=flarum.core.compat["common/utils/extractText"]},,,,,function(t,n){t.exports=flarum.core.compat["components/ExtensionPage"]},function(t,n){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,n){t.exports=flarum.core.compat["common/Component"]},function(t,n){t.exports=flarum.core.compat["common/utils/saveSettings"]},function(t,n){t.exports=flarum.core.compat["common/components/Modal"]},function(t,n,e){"use strict";function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function a(t,n){return(a=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function o(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,a(t,n)}function r(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}e.r(n);var l=e(1),s=e.n(l),c=e(9),u=e.n(c),d=e(0),h=e.n(d),f=e(3),v=e.n(f),p=e(10),b=e.n(p),g=e(11),w=e.n(g),k=e(4),y=e.n(k),x=function(t){function n(){return t.apply(this,arguments)||this}o(n,t);var e=n.prototype;return e.view=function(){return m("input",{type:"text","aria-labelled-by":this.attrs.labelId,className:"FormControl "+this.attrs.class,placeholder:y()(this.attrs.placeholder),disabled:!!this.attrs.disabled,value:this.attrs.value,onchange:this.onChange.bind(this)})},e.onChange=function(t){if("function"==typeof this.attrs.onChange){var n=t.target;this.attrs.onChange(n.value,n)}},n}(w.a),D=e(12),_=e.n(D),L=e(2);function O(t){var n;try{n=new URL(t)}catch(t){return!1}return("http:"===n.protocol||"https:"===n.protocol)&&n.hostname.includes(".")}var S=e(13),B=function(t,n){return app.translator.trans("davwheat.custom_sidenav_links.admin.settings_page.new_link_modal."+t,n)},j=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];return r(i(n=t.call.apply(t,[this].concat(a))||this),"loading",!1),r(i(n),"newLink",new L.a("","","",!1)),n}o(n,t);var e=n.prototype;return e.className=function(){return"davwheat-sidenav-AddLinkModal Modal--small"},e.title=function(){return B("title")},e.content=function(){var t=this,n=O(this.newLink.url);return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("div",null,m("label",null,B("labels.icon"),m("div",{class:"icon-preview-container"},m("span",{class:"icon-preview fa-fw "+this.newLink.icon,title:B("table.icon_preview_tooltip")}),m(x,{value:this.newLink.icon,onChange:function(n){t.newLink.icon=n},placeholder:B("placeholders.icon"),disabled:!1})))),m("div",null,m("label",null,B("labels.text"),m(x,{value:this.newLink.text,onChange:function(n){t.newLink.text=n},placeholder:B("placeholders.text"),disabled:!1}))),m("div",null,m("label",null,B("labels.url"),m(x,{class:!n&&"sidenav-input--invalid",value:this.newLink.url,onChange:function(n){t.newLink.url=n},placeholder:B("placeholders.url"),disabled:!1}))),m("div",null,m(v.a,{state:this.newLink.internal,onchange:function(n){t.newLink.internal=n},disabled:!1},B("labels.internal"))),m(h.a,{className:"Button Button--primary",type:"submit",disabled:!n||this.loading||!this.isValid(),loading:this.loading},this.getButtonText(n)))))},e.getButtonText=function(t){return t?this.loading?B("submit_btn.loading"):this.isValid()?B("submit_btn.add"):B("submit_btn.invalid_form"):B("submit_btn.fix_url")},e.isValid=function(){return""!==this.newLink.icon.trim()&&""!==this.newLink.text.trim()&&""!==this.newLink.url.trim()},e.onsubmit=function(t){t.preventDefault(),this.loading=!0,this.hide.bind(this)(),this.attrs.links.push(this.newLink)},n}(e.n(S).a),N="davwheat-custom-sidenav-links.link-data",C=function(t,n){return s.a.translator.trans("davwheat.custom_sidenav_links.admin.settings_page."+t,n)},I=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),o=0;o<e;o++)a[o]=arguments[o];return r(i(n=t.call.apply(t,[this].concat(a))||this),"settings",{}),r(i(n),"loading",!1),r(i(n),"isDirty",!1),r(i(n),"isAnyUrlInvalid",!1),r(i(n),"rawLinkData",s.a.data.settings["davwheat-custom-sidenav-links.link-data"]),r(i(n),"linkData",null),n}o(n,t);var e=n.prototype;return e.oninit=function(n){t.prototype.oninit.call(this,n),this.createData()},e.content=function(){var t=this;if(!this.rawLinkData)return m("p",null,"My settings key (",m("code",null,N),") is missing from your database! Make sure you've run the migrations. If that doesn't work, add it to your settings table manually with the content ",m("code",null,"[]"),".");if(!this.linkData)return m("div",{class:"davwheat-ext-settings"},m("form",null,m(b.a,null)));var n=!1;return m("div",{class:"davwheat-ext-settings"},m("form",null,m("section",{class:"davwheat-sidenav-addlink"},m("h2",null,C("heading")),m(h.a,{class:"Button davwheat-sidenav-addlink-btn",icon:"fas fa-plus",onclick:function(){s.a.modal.show(j,{links:t.linkData}),t.makeDirty()}},C("add_link_btn"))),m("div",{class:"scroll-container"},m("main",null,m("div",{id:"davwheat-sidenav--position-heading"},C("table.header.position")),m("div",{id:"davwheat-sidenav--icon-heading"},C("table.header.icon")),m("div",{id:"davwheat-sidenav--text-heading"},C("table.header.text")),m("div",{id:"davwheat-sidenav--url-heading"},C("table.header.url")),m("div",{id:"davwheat-sidenav--internal-heading"},C("table.header.internal")),m("div",{id:"davwheat-sidenav--delete-heading"},C("table.header.delete")),this.linkData.map((function(e,i){var a,o=O(e.url);return o||(n=!0),[m("div",{"data-column":"position"},m(h.a,{class:"Button Button--icon",icon:"fas fa-arrow-up",title:C("table.tooltips.move_up"),disabled:0===i,onclick:function(){if(0!==i){t.linkData[i]=t.linkData[i-1],t.linkData[i-1]=e}}}),m(h.a,{class:"Button Button--icon",icon:"fas fa-arrow-down",title:C("table.tooltips.move_down"),disabled:i===((null==(a=t.linkData)?void 0:a.length)||1)-1,onclick:function(){var n;if(i!==((null==(n=t.linkData)?void 0:n.length)||1)-1){t.linkData[i]=t.linkData[i+1],t.linkData[i+1]=e}}})),m("div",{"data-column":"icon"},m("span",{class:"icon-preview fa-fw "+e.icon,title:C("table.tooltips.icon_preview")}),m(x,{value:e.icon,onChange:function(n){t.linkData[i].icon=n,t.makeDirty()},labelId:"davwheat-sidenav--icon-heading",placeholder:C("table.placeholders.icon"),disabled:!1})),m("div",{"data-column":"text"},m(x,{value:e.text,onChange:function(n){t.linkData[i].text=n,t.makeDirty()},labelId:"davwheat-sidenav--text-heading",placeholder:C("table.placeholders.text"),disabled:!1})),m("div",{"data-column":"url"},m(x,{class:!o&&"sidenav-input--invalid",value:e.url,onChange:function(n){t.linkData[i].url=n,t.makeDirty()},labelId:"davwheat-sidenav--url-heading",placeholder:C("table.placeholders.url"),disabled:!1})),m("div",{"data-column":"internal"},m(v.a,{state:e.internal,onchange:function(n){t.linkData[i].internal=n,t.makeDirty()},"aria-labelled-by":"davwheat-sidenav--url-heading",disabled:!1})),m("div",{"data-column":"delete"},m(h.a,{class:"Button Button--icon",icon:"fas fa-trash","aria-labelled-by":"davwheat-sidenav--delete-heading",onclick:function(){var n;confirm(y()(C("confirm_delete",{link:e.text})))&&(null==(n=t.linkData)||n.splice(i,1))}}))]})))),m(h.a,{onclick:this.saveSettings.bind(this),className:"Button Button--primary",loading:this.loading,disabled:n||!this.isDirty||this.loading},this.getButtonText(n))))},e.getButtonText=function(t){return this.isAnyUrlInvalid=t,this.isAnyUrlInvalid?C("save_btn.fix_errors"):this.loading?C("save_btn.saving"):this.isDirty?C("save_btn.dirty"):C("save_btn.saved")},e.createData=function(){var t,n=this.rawLinkData;try{t=Object.freeze(JSON.parse(n))}catch(t){throw"Invalid JSON found in Flarum setting `"+N+"`. We can't continue. Fix manually, or reset to `[]` in your DB."}var e=[];t.forEach((function(t){return e.push(L.a.fromJsObject(t))})),this.linkData=e},e.makeDirty=function(){this.isDirty=!0},e.saveSettings=function(t){var n;if(t.preventDefault(),!this.isAnyUrlInvalid){s.a.alerts.clear(),this.loading=!0;var e=JSON.stringify(this.linkData);return console.log(e),_()((n={},n[N]=JSON.stringify(this.linkData),n)).then(this.onSettingsSaved.bind(this))}s.a.alerts.show({type:"error"},C("alert.fix_errors"))},e.onSettingsSaved=function(){this.loading=!1,this.isDirty=!1,s.a.alerts.show({type:"success"},s.a.translator.trans("core.admin.settings.saved_message"))},n}(u.a);app.initializers.add("davwheat/custom-sidenav-links",(function(t){t.extensionData.for("davwheat-custom-sidenav-links").registerPage(I)}))}]);
//# sourceMappingURL=admin.js.map