module.exports=function(t){var n={};function a(i){if(n[i])return n[i].exports;var e=n[i]={i:i,l:!1,exports:{}};return t[i].call(e.exports,e,e.exports,a),e.l=!0,e.exports}return a.m=t,a.c=n,a.d=function(t,n,i){a.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,n){if(1&n&&(t=a(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var e in t)a.d(i,e,function(n){return t[n]}.bind(null,e));return i},a.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(n,"a",n),n},a.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},a.p="",a(a.s=15)}([function(t,n){t.exports=flarum.core.compat.app},function(t,n){t.exports=flarum.core.compat["common/components/Button"]},function(t,n,a){"use strict";a.d(n,"a",(function(){return i}));var i=function(){function t(t,n,a,i){this.icon=t,this.text=n,this.url=a,this.internal=i}t.fromJsObject=function(n){return new t(n.icon,n.text,n.url,n.internal)};var n=t.prototype;return n.toString=function(){return JSON.stringify({icon:this.icon,text:this.text,url:this.url,internal:this.internal})},n.toJSON=function(){return{icon:this.icon,text:this.text,url:this.url,internal:this.internal}},t}()},function(t,n){t.exports=flarum.core.compat["common/utils/extractText"]},function(t,n){t.exports=flarum.core.compat["common/components/Switch"]},function(t,n){t.exports=flarum.core.compat["common/Component"]},,,,,function(t,n){t.exports=flarum.core.compat["components/ExtensionPage"]},function(t,n){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,n){t.exports=flarum.core.compat["common/components/Select"]},function(t,n){t.exports=flarum.core.compat["common/utils/saveSettings"]},function(t,n){t.exports=flarum.core.compat["common/components/Modal"]},function(t,n,a){"use strict";function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function e(t,n){return(e=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function o(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,e(t,n)}function l(t,n,a){return n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}a.r(n);var s=a(0),r=a.n(s),d=a(10),c=a.n(d),u=a(1),h=a.n(u),p=a(4),v=a.n(p),f=a(11),b=a.n(f),g=a(5),k=a.n(g),w=a(3),y=a.n(w),_=function(t){function n(){return t.apply(this,arguments)||this}o(n,t);var a=n.prototype;return a.view=function(){return m("input",{type:"text","aria-labelled-by":this.attrs.labelId,className:"FormControl "+this.attrs.class,placeholder:y()(this.attrs.placeholder),disabled:!!this.attrs.disabled,value:this.attrs.value,onchange:this.onChange.bind(this)})},a.onChange=function(t){if("function"==typeof this.attrs.onChange){var n=t.target;this.attrs.onChange(n.value,n)}},n}(k.a),x=a(12),D=a.n(x),S=function(t){function n(){return t.apply(this,arguments)||this}o(n,t);var a=n.prototype;return a.view=function(){return m(D.a,{type:"text",className:"FormControl "+this.attrs.class,disabled:!!this.attrs.disabled,value:this.attrs.value,onchange:this.onChange.bind(this),options:this.attrs.options})},a.onChange=function(t){"function"==typeof this.attrs.onChange&&this.attrs.onChange(t)},n}(k.a),B=a(13),L=a.n(B),O=a(2);function C(t){var n;try{n=new URL(t)}catch(t){return!1}return("http:"===n.protocol||"https:"===n.protocol)&&n.hostname.includes(".")}var N=a(14),j=function(t,n){return app.translator.trans("davwheat.custom_sidenav_links.admin.settings_page.new_link_modal."+t,n)},P=function(t){function n(){for(var n,a=arguments.length,e=new Array(a),o=0;o<a;o++)e[o]=arguments[o];return l(i(n=t.call.apply(t,[this].concat(e))||this),"loading",!1),l(i(n),"newLink",new O.a("","","",!1)),n}o(n,t);var a=n.prototype;return a.className=function(){return"davwheat-sidenav-AddLinkModal Modal--small"},a.title=function(){return y()(j("title"))},a.content=function(){var t=this,n=C(this.newLink.url);return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("div",null,m("label",null,j("labels.icon"),m("div",{class:"icon-preview-container"},m("span",{class:"icon-preview fa-fw "+this.newLink.icon,title:j("table.icon_preview_tooltip")}),m(_,{value:this.newLink.icon,onChange:function(n){t.newLink.icon=n},placeholder:j("placeholders.icon"),disabled:!1})))),m("div",null,m("label",null,j("labels.text"),m(_,{value:this.newLink.text,onChange:function(n){t.newLink.text=n},placeholder:j("placeholders.text"),disabled:!1}))),m("div",null,m("label",null,j("labels.url"),m(_,{class:!n&&"sidenav-input--invalid",value:this.newLink.url,onChange:function(n){t.newLink.url=n},placeholder:j("placeholders.url"),disabled:!1}))),m("div",null,m(v.a,{state:this.newLink.internal,onchange:function(n){t.newLink.internal=n},disabled:!1},j("labels.internal"))),m(h.a,{className:"Button Button--primary",type:"submit",disabled:!n||this.loading||!this.isValid(),loading:this.loading},this.getButtonText(n)))))},a.getButtonText=function(t){return t?this.loading?j("submit_btn.loading"):this.isValid()?j("submit_btn.add"):j("submit_btn.invalid_form"):j("submit_btn.fix_url")},a.isValid=function(){return""!==this.newLink.icon.trim()&&""!==this.newLink.text.trim()&&""!==this.newLink.url.trim()},a.onsubmit=function(){this.loading=!0,this.hide.bind(this)(),this.attrs.links.push(this.newLink)},n}(a.n(N).a),I="davwheat-custom-sidenav-links.link-data",T=function(t,n){return r.a.translator.trans("davwheat.custom_sidenav_links.admin.settings_page."+t,n)},M=function(t){function n(){for(var n,a=arguments.length,e=new Array(a),o=0;o<a;o++)e[o]=arguments[o];return l(i(n=t.call.apply(t,[this].concat(e))||this),"loading",!1),l(i(n),"isDirty",!1),l(i(n),"isAnyUrlInvalid",!1),l(i(n),"rawLinkData",r.a.data.settings["davwheat-custom-sidenav-links.link-data"]),l(i(n),"linkData",null),l(i(n),"linkPosition",r.a.data.settings["davwheat-custom-sidenav-links.position"]||"above-tags-link"),l(i(n),"showTopSpacer",r.a.data.settings["davwheat-custom-sidenav-links.top-spacer"]||!0),l(i(n),"showBottomSpacer",r.a.data.settings["davwheat-custom-sidenav-links.bottom-spacer"]||!0),n}o(n,t);var a=n.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.createData()},a.content=function(){var t=this;if(!this.rawLinkData)return m("p",null,"My settings key (",m("code",null,I),") is missing from your database! Make sure you've run the migrations. If that doesn't work, add it to your settings table manually with the content ",m("code",null,"[]"),".");if(!this.linkData)return m("div",{class:"davwheat-ext-settings"},m("form",null,m(b.a,null)));var n=!1;return m("div",{class:"davwheat-ext-settings"},m("form",null,m("section",{className:"davwheat-sidenav-addlink davwheat-custom-sidenav-links--display-options"},m("h2",null,T("display_options.heading")),m("label",null,T("display_options.labels.position"),m(S,{value:this.linkPosition,options:{"above-tags-link":T("display_options.options.position.above-tags-link"),"below-tags-link":T("display_options.options.position.below-tags-link")},disabled:this.loading,onChange:function(n){console.log(n),t.linkPosition=n,t.makeDirty()}})),m("label",null,T("display_options.labels.top_spacer"),m(v.a,{state:this.showTopSpacer,disabled:this.loading,onchange:function(n){t.showTopSpacer=n,t.makeDirty()}})),m("label",null,T("display_options.labels.bottom_spacer"),m(v.a,{state:this.showBottomSpacer,disabled:this.loading,onchange:function(n){t.showBottomSpacer=n,t.makeDirty()}})))),m("form",null,m("section",{class:"davwheat-sidenav-addlink"},m("h2",null,T("link_table.heading")),m(h.a,{class:"Button davwheat-sidenav-addlink-btn",icon:"fas fa-plus",onclick:function(){r.a.modal.show(P,{links:t.linkData}),t.makeDirty()},disabled:this.loading},T("link_table.add_link_btn"))),m("div",{class:"scroll-container"},m("main",null,m("div",{id:"davwheat-sidenav--position-heading"},T("link_table.table.header.position")),m("div",{id:"davwheat-sidenav--icon-heading"},T("link_table.table.header.icon")),m("div",{id:"davwheat-sidenav--text-heading"},T("link_table.table.header.text")),m("div",{id:"davwheat-sidenav--url-heading"},T("link_table.table.header.url")),m("div",{id:"davwheat-sidenav--internal-heading"},T("link_table.table.header.internal")),m("div",{id:"davwheat-sidenav--delete-heading"},T("link_table.table.header.delete")),this.linkData.map((function(a,i){var e,o=C(a.url);return o||(n=!0),[m("div",{"data-column":"position"},m(h.a,{class:"Button Button--icon",icon:"fas fa-arrow-up",title:T("link_table.table.tooltips.move_up"),disabled:0===i||t.loading,onclick:function(){0!==i&&t.linkData&&(t.linkData[i]=t.linkData[i-1],t.linkData[i-1]=a)}}),m(h.a,{class:"Button Button--icon",icon:"fas fa-arrow-down",title:T("link_table.table.tooltips.move_down"),disabled:i===((null==(e=t.linkData)?void 0:e.length)||1)-1||t.loading,onclick:function(){var n;i!==((null==(n=t.linkData)?void 0:n.length)||1)-1&&t.linkData&&(t.linkData[i]=t.linkData[i+1],t.linkData[i+1]=a)}})),m("div",{"data-column":"icon"},m("span",{class:"icon-preview fa-fw "+a.icon,title:T("link_table.table.tooltips.icon_preview")}),m(_,{value:a.icon,onChange:function(n){t.linkData&&(t.linkData[i].icon=n,t.makeDirty())},labelId:"davwheat-sidenav--icon-heading",placeholder:T("link_table.table.placeholders.icon"),disabled:t.loading})),m("div",{"data-column":"text"},m(_,{value:a.text,onChange:function(n){t.linkData&&(t.linkData[i].text=n,t.makeDirty())},labelId:"davwheat-sidenav--text-heading",placeholder:T("link_table.table.placeholders.text"),disabled:t.loading})),m("div",{"data-column":"url"},m(_,{class:!o&&"sidenav-input--invalid",value:a.url,onChange:function(n){t.linkData&&(t.linkData[i].url=n,t.makeDirty())},labelId:"davwheat-sidenav--url-heading",placeholder:T("link_table.table.placeholders.url"),disabled:t.loading})),m("div",{"data-column":"internal"},m(v.a,{state:a.internal,onchange:function(n){t.linkData&&(t.linkData[i].internal=n,t.makeDirty())},"aria-labelled-by":"davwheat-sidenav--url-heading",disabled:t.loading})),m("div",{"data-column":"delete"},m(h.a,{class:"Button Button--icon",icon:"fas fa-trash","aria-labelled-by":"davwheat-sidenav--delete-heading",onclick:function(){var n;confirm(y()(T("link_table.confirm_delete",{link:a.text})))&&(null==(n=t.linkData)||n.splice(i,1))},disabled:t.loading}))]})))),m(h.a,{onclick:this.saveSettings.bind(this),className:"Button Button--primary",loading:this.loading,disabled:n||!this.isDirty||this.loading},this.getButtonText(n))))},a.getButtonText=function(t){return this.isAnyUrlInvalid=t,this.isAnyUrlInvalid?T("link_table.save_btn.fix_errors"):this.loading?T("link_table.save_btn.saving"):this.isDirty?T("link_table.save_btn.dirty"):T("link_table.save_btn.saved")},a.createData=function(){var t,n=this.rawLinkData;try{t=Object.freeze(JSON.parse(n))}catch(t){throw"Invalid JSON found in Flarum setting `"+I+"`. We can't continue. Fix manually, or reset to `[]` in your DB."}var a=[];t.forEach((function(t){return a.push(O.a.fromJsObject(t))})),this.linkData=a},a.makeDirty=function(){this.isDirty=!0},a.saveSettings=function(t){var n;if(t.preventDefault(),!this.isAnyUrlInvalid){r.a.alerts.clear(),this.loading=!0;var a=JSON.stringify(this.linkData);return console.log(a),L()((n={},n[I]=JSON.stringify(this.linkData),n["davwheat-custom-sidenav-links.position"]=this.linkPosition,n["davwheat-custom-sidenav-links.top-spacer"]=this.showTopSpacer,n["davwheat-custom-sidenav-links.bottom-spacer"]=this.showBottomSpacer,n)).then(this.onSettingsSaved.bind(this))}r.a.alerts.show({type:"error"},T("link_table.alert.fix_errors"))},a.onSettingsSaved=function(){this.loading=!1,this.isDirty=!1,r.a.alerts.show({type:"success"},r.a.translator.trans("core.admin.settings.saved_message"))},n}(c.a);app.initializers.add("davwheat/custom-sidenav-links",(function(t){t.extensionData.for("davwheat-custom-sidenav-links").registerPage(M)}))}]);
//# sourceMappingURL=admin.js.map