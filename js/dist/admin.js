(()=>{var t={n:n=>{var a=n&&n.__esModule?()=>n.default:()=>n;return t.d(a,{a}),a},d:(n,a)=>{for(var i in a)t.o(a,i)&&!t.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:a[i]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n)};(()=>{"use strict";function n(t,a){return n=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},n(t,a)}function a(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,n(t,a)}const i=flarum.core.compat.app;var e=t.n(i);const o=flarum.core.compat["components/ExtensionPage"];var l=t.n(o);const s=flarum.core.compat["common/components/Button"];var r=t.n(s);const d=flarum.core.compat["common/components/Switch"];var c=t.n(d);const u=flarum.core.compat["common/components/LoadingIndicator"];var h=t.n(u);const v=flarum.core.compat["common/Component"];var p=t.n(v);const b=flarum.core.compat["common/utils/extractText"];var k=t.n(b),f=function(t){function n(){return t.apply(this,arguments)||this}a(n,t);var i=n.prototype;return i.view=function(){return m("input",{type:"text","aria-labelled-by":this.attrs.labelId,className:"FormControl "+this.attrs.class,placeholder:k()(this.attrs.placeholder),disabled:!!this.attrs.disabled,value:this.attrs.value,onchange:this.onChange.bind(this)})},i.onChange=function(t){if("function"==typeof this.attrs.onChange){var n=t.target;this.attrs.onChange(n.value,n)}},n}(p());const g=flarum.core.compat["common/components/Select"];var w=t.n(g),y=function(t){function n(){return t.apply(this,arguments)||this}a(n,t);var i=n.prototype;return i.view=function(){return m(w(),{className:"FormControl "+this.attrs.class,disabled:!!this.attrs.disabled,value:this.attrs.value,onchange:this.onChange.bind(this),options:this.attrs.options})},i.onChange=function(t){"function"==typeof this.attrs.onChange&&this.attrs.onChange(t)},n}(p());const _=flarum.core.compat["common/utils/saveSettings"];var D=t.n(_),x=function(){function t(t,n,a,i){this.icon=t,this.text=n,this.url=a,this.internal=i||!1}t.fromJsObject=function(n){return new t(n.icon,n.text,n.url,n.internal)};var n=t.prototype;return n.toString=function(){return JSON.stringify({icon:this.icon,text:this.text,url:this.url,internal:this.internal})},n.toJSON=function(){return{icon:this.icon,text:this.text,url:this.url,internal:this.internal}},t}();function S(t){var n;try{n=new URL(t)}catch(t){return!1}return("http:"===n.protocol||"https:"===n.protocol)&&n.hostname.includes(".")}const B=flarum.core.compat["common/components/Modal"];var L=function(t,n){return app.translator.trans("davwheat.custom_sidenav_links.admin.settings_page.new_link_modal."+t,n)},C=function(t){function n(){for(var n,a=arguments.length,i=new Array(a),e=0;e<a;e++)i[e]=arguments[e];return(n=t.call.apply(t,[this].concat(i))||this).loading=!1,n.newLink=new x("","","",!1),n}a(n,t);var i=n.prototype;return i.className=function(){return"davwheat-sidenav-AddLinkModal Modal--small"},i.title=function(){return k()(L("title"))},i.content=function(){var t=this,n=S(this.newLink.url);return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("div",null,m("label",null,L("labels.icon"),m("div",{class:"icon-preview-container"},m("span",{class:"icon-preview fa-fw "+this.newLink.icon,title:L("table.icon_preview_tooltip")}),m(f,{value:this.newLink.icon,onChange:function(n){t.newLink.icon=n},placeholder:L("placeholders.icon"),disabled:!1})))),m("div",null,m("label",null,L("labels.text"),m(f,{value:this.newLink.text,onChange:function(n){t.newLink.text=n},placeholder:L("placeholders.text"),disabled:!1}))),m("div",null,m("label",null,L("labels.url"),m(f,{class:!n&&"sidenav-input--invalid",value:this.newLink.url,onChange:function(n){t.newLink.url=n},placeholder:L("placeholders.url"),disabled:!1}))),m("div",null,m(c(),{state:this.newLink.internal,onchange:function(n){t.newLink.internal=n},disabled:!1},L("labels.internal"))),m(r(),{className:"Button Button--primary",type:"submit",disabled:!n||this.loading||!this.isValid(),loading:this.loading},this.getButtonText(n)))))},i.getButtonText=function(t){return t?this.loading?L("submit_btn.loading"):this.isValid()?L("submit_btn.add"):L("submit_btn.invalid_form"):L("submit_btn.fix_url")},i.isValid=function(){return""!==this.newLink.icon.trim()&&""!==this.newLink.text.trim()&&""!==this.newLink.url.trim()},i.onsubmit=function(){this.loading=!0,this.hide.bind(this)(),this.attrs.links.push(this.newLink)},n}(t.n(B)()),N="davwheat-custom-sidenav-links.link-data",O=function(t,n){return e().translator.trans("davwheat.custom_sidenav_links.admin.settings_page."+t,n)},I=function(t){function n(){for(var n,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(n=t.call.apply(t,[this].concat(i))||this).loading=!1,n.isDirty=!1,n.isAnyUrlInvalid=!1,n.rawLinkData=e().data.settings["davwheat-custom-sidenav-links.link-data"],n.linkData=null,n.linkPosition=e().data.settings["davwheat-custom-sidenav-links.position"]||"above-tags-link",n.showTopSpacer=e().data.settings["davwheat-custom-sidenav-links.top-spacer"]||!0,n.showBottomSpacer=e().data.settings["davwheat-custom-sidenav-links.bottom-spacer"]||!0,n}a(n,t);var i=n.prototype;return i.oninit=function(n){t.prototype.oninit.call(this,n),this.createData()},i.content=function(){var t=this;if(!this.rawLinkData)return m("p",null,"My settings key (",m("code",null,N),") is missing from your database! Make sure you've run the migrations. If that doesn't work, add it to your settings table manually with the content ",m("code",null,"[]"),".");if(!this.linkData)return m("div",{class:"davwheat-ext-settings"},m("form",null,m(h(),null)));var n=!1;return m("div",{class:"davwheat-ext-settings"},m("form",null,m("section",{className:"davwheat-sidenav-addlink davwheat-custom-sidenav-links--display-options"},m("h2",null,O("display_options.heading")),m("label",null,O("display_options.labels.position"),m(y,{value:this.linkPosition,options:{"above-tags-link":O("display_options.options.position.above-tags-link"),"below-tags-link":O("display_options.options.position.below-tags-link")},disabled:this.loading,onChange:function(n){t.linkPosition=n,t.makeDirty()}})),m("label",null,O("display_options.labels.top_spacer"),m(c(),{state:this.showTopSpacer,disabled:this.loading,onchange:function(n){t.showTopSpacer=n,t.makeDirty()}})),m("label",null,O("display_options.labels.bottom_spacer"),m(c(),{state:this.showBottomSpacer,disabled:this.loading,onchange:function(n){t.showBottomSpacer=n,t.makeDirty()}})))),m("form",null,m("section",{class:"davwheat-sidenav-addlink"},m("h2",null,O("link_table.heading")),m(r(),{class:"Button davwheat-sidenav-addlink-btn",icon:"fas fa-plus",onclick:function(){e().modal.show(C,{links:t.linkData}),t.makeDirty()},disabled:this.loading},O("link_table.add_link_btn"))),m("div",{class:"scroll-container"},m("main",null,m("div",{id:"davwheat-sidenav--position-heading"},O("link_table.table.header.position")),m("div",{id:"davwheat-sidenav--icon-heading"},O("link_table.table.header.icon")),m("div",{id:"davwheat-sidenav--text-heading"},O("link_table.table.header.text")),m("div",{id:"davwheat-sidenav--url-heading"},O("link_table.table.header.url")),m("div",{id:"davwheat-sidenav--internal-heading"},O("link_table.table.header.internal")),m("div",{id:"davwheat-sidenav--delete-heading"},O("link_table.table.header.delete")),this.linkData.map((function(a,i){var e,o=S(a.url);return o||(n=!0),[m("div",{"data-column":"position"},m(r(),{class:"Button Button--icon",icon:"fas fa-arrow-up",title:O("link_table.table.tooltips.move_up"),disabled:0===i||t.loading,onclick:function(){0!==i&&t.linkData&&(t.linkData[i]=t.linkData[i-1],t.linkData[i-1]=a)}}),m(r(),{class:"Button Button--icon",icon:"fas fa-arrow-down",title:O("link_table.table.tooltips.move_down"),disabled:i===((null==(e=t.linkData)?void 0:e.length)||1)-1||t.loading,onclick:function(){var n;i!==((null==(n=t.linkData)?void 0:n.length)||1)-1&&t.linkData&&(t.linkData[i]=t.linkData[i+1],t.linkData[i+1]=a)}})),m("div",{"data-column":"icon"},m("span",{class:"icon-preview fa-fw "+a.icon,title:O("link_table.table.tooltips.icon_preview")}),m(f,{value:a.icon,onChange:function(n){t.linkData&&(t.linkData[i].icon=n,t.makeDirty())},labelId:"davwheat-sidenav--icon-heading",placeholder:O("link_table.table.placeholders.icon"),disabled:t.loading})),m("div",{"data-column":"text"},m(f,{value:a.text,onChange:function(n){t.linkData&&(t.linkData[i].text=n,t.makeDirty())},labelId:"davwheat-sidenav--text-heading",placeholder:O("link_table.table.placeholders.text"),disabled:t.loading})),m("div",{"data-column":"url"},m(f,{class:!o&&"sidenav-input--invalid",value:a.url,onChange:function(n){t.linkData&&(t.linkData[i].url=n,t.makeDirty())},labelId:"davwheat-sidenav--url-heading",placeholder:O("link_table.table.placeholders.url"),disabled:t.loading})),m("div",{"data-column":"internal"},m(c(),{state:a.internal,onchange:function(n){t.linkData&&(t.linkData[i].internal=n,t.makeDirty())},"aria-labelled-by":"davwheat-sidenav--url-heading",disabled:t.loading})),m("div",{"data-column":"delete"},m(r(),{class:"Button Button--icon",icon:"fas fa-trash","aria-labelled-by":"davwheat-sidenav--delete-heading",onclick:function(){var n;confirm(k()(O("link_table.confirm_delete",{link:a.text})))&&(null==(n=t.linkData)||n.splice(i,1))},disabled:t.loading}))]})))),m(r(),{onclick:this.saveSettings.bind(this),className:"Button Button--primary",loading:this.loading,disabled:n||!this.isDirty||this.loading},this.getButtonText(n))))},i.getButtonText=function(t){return this.isAnyUrlInvalid=t,this.isAnyUrlInvalid?O("link_table.save_btn.fix_errors"):this.loading?O("link_table.save_btn.saving"):this.isDirty?O("link_table.save_btn.dirty"):O("link_table.save_btn.saved")},i.createData=function(){var t,n=this.rawLinkData;try{t=Object.freeze(JSON.parse(n))}catch(t){throw"Invalid JSON found in Flarum setting `"+N+"`. We can't continue. Fix manually, or reset to `[]` in your DB."}var a=[];t.forEach((function(t){return a.push(x.fromJsObject(t))})),this.linkData=a},i.makeDirty=function(){this.isDirty=!0},i.saveSettings=function(t){var n;if(t.preventDefault(),!this.isAnyUrlInvalid)return e().alerts.clear(),this.loading=!0,JSON.stringify(this.linkData),D()((n={},n[N]=JSON.stringify(this.linkData),n["davwheat-custom-sidenav-links.position"]=this.linkPosition,n["davwheat-custom-sidenav-links.top-spacer"]=this.showTopSpacer,n["davwheat-custom-sidenav-links.bottom-spacer"]=this.showBottomSpacer,n)).then(this.onSettingsSaved.bind(this));e().alerts.show({type:"error"},O("link_table.alert.fix_errors"))},i.onSettingsSaved=function(){this.loading=!1,this.isDirty=!1,e().alerts.show({type:"success"},e().translator.trans("core.admin.settings.saved_message"))},n}(l());app.initializers.add("davwheat/custom-sidenav-links",(function(t){t.extensionData.for("davwheat-custom-sidenav-links").registerPage(I)}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map